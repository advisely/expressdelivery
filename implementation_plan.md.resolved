# Web-Hybrid Mail Client & MCP Server Architecture

This plan outlines the creation of a standalone, multi-account mail client for Windows and Linux. It combines premium desktop aesthetics with a persistent, local Model Context Protocol (MCP) server, allowing AI agents like OpenClaw to seamlessly assist with email management.

## User Review Required
> [!IMPORTANT]
> Please review the feature set in **Core Mail Features** to ensure all desired capabilities from top clients (Spark, Mailbird, Thunderbird) are included. Let me know if you would like to prioritize specific integrations (like Calendar or Chat) or focus strictly on email management first.

---

## Proposed Architecture

### 1. Core Framework: Electron + Node.js
- **Main Process (Backend)**: Handles database connections, email syncing loops, OAuth2 flows, and runs the local MCP server over SSE.
- **Renderer Process (Frontend)**: Handles the beautiful, responsive UI.

### 2. UI / Frontend Stack: React + Vite + Vanilla CSS
- **Framework**: React with Vite for fast builds and hot-module replacement.
- **Styling**: Native CSS variables focusing on **premium aesthetics** (glassmorphism, fluid micro-animations, customizable dark/light themes).
- **Typography**: Modern fonts (e.g., *Inter* or *Outfit*) for optimal readability.

### 3. Local Storage & Security
- **Database**: `better-sqlite3` for fast, offline indexing and querying of emails and contacts.
- **Security**: OS-native keychain encryption via Electron's `safeStorage` API to protect OAuth tokens, passwords, and MCP API keys. Privacy features include local-only data storage and email tracker blocking.

---

## Core Mail Features

Based on research of top clients (Spark, Mailbird, Thunderbird), the client will implement:

1. **Unified Inbox & Multi-Account Management**: Consolidate IMAP, Gmail, and Outlook accounts into a single view.
2. **Smart / Focused Inbox**: Automatically categorize incoming mail (Personal, Newsletters, Notifications) to reduce clutter.
3. **Snoozing & Scheduling**: Temporarily hide emails for later review and schedule outgoing emails for specific times.
4. **Gatekeeper & Privacy**: Screen new senders before allowing them into the inbox and block tracking pixels.
5. **Quick Replies & Templates**: Save time with predefined HTML templates and quick action shortcuts.
6. **Advanced Offline Search**: Instantly locate emails using the local SQLite index without waiting for network requests.

---

## MCP Server Integration

The mail client doubles as a persistent MCP Server, accessible via `http://localhost:<PORT>/sse`.

### Exposed Agent Tools
- `search_emails(query: string, folder?: string)`: Execute fast SQLite full-text search.
- `read_thread(thread_id: string)`: Retrieve the full context of an email chain.
- `send_email(to: string[], subject: string, html: string)`: Send a new email using the configured SMTP connection.
- `create_draft(to: string[], subject: string, html: string)`: Prepare a draft for the user to review in the UI before sending.
- `manage_categories()`: Allow the AI to help categorize and tag emails to support the Smart Inbox feature.

---

## Verification Plan

### Automated Tests
- Unit tests for the local SQLite schema and migrations.
- Integration tests for connecting to standard IMAP/SMTP test servers.
- Tests for the MCP HTTP/SSE server to ensure proper message format and tool execution.

### Manual Verification
- Install the `.exe` (Windows) and `.AppImage` (Linux) to verify system integration (System Tray, notifications).
- Connect an AI Agent (e.g., OpenClaw, Claude Desktop) to the local MCP port and test the reading/drafting tools.
- Bind multiple real email accounts to test the Unified Inbox rendering and syncing speed.
